import{_ as R}from"./index.76ed4355.js";import{_ as U,d as x,g as $,q as P,f as B,B as L,b as O}from"./index.c8e2dcea.js";import{e as V,a as A,g as j,d as q,c as K}from"./user.c0f1c8a5.js";import{F as m}from"./componentEnum.0faf2556.js";import{g as N}from"./role.a9dd1ead.js";import{g as k}from"./dept.78c31990.js";import{S as z}from"./basic.9db2ab82.js";import{_ as M}from"./index.6af4874b.js";import{d as b,aB as F,n as E,aQ as I,J as H,b0 as J,o as C,v as S,w,b as _,u as o,c as Q,$ as G,f as W,k as X,N as Y}from"./.pnpm.b1628590.js";import{_ as Z}from"./base-form.vue_vue_type_script_setup_true_lang.c98d8f13.js";import"./base-table.2b7e77b0.js";import"./base-column-setting.a0a6ed20.js";import"./base-filter.7cf189b8.js";import"./base-select.vue_vue_type_script_lang.6ab47f0d.js";import"./base-input-number.4f01add9.js";import"./base-icon-picker.vue_vue_type_style_index_0_lang.13a967cb.js";function v(u){const p=[{fieldName:"username",fieldDesc:"\u7528\u6237\u540D",fieldType:m.INPUT},{fieldName:"role",fieldDesc:"\u89D2\u8272",fieldType:m.SELECT,config:{api:N,labelKey:"roleName",valueKey:"role"}},{fieldName:"status",fieldDesc:"\u72B6\u6001",fieldType:m.SELECT,config:{options:z}}],a=[{fieldName:"id",fieldDesc:"id",showOverflowTooltip:!0},{fieldName:"username",fieldDesc:"\u7528\u6237\u540D"},{fieldName:"deptName",fieldDesc:"\u90E8\u95E8",showOverflowTooltip:!0},{fieldName:"role",fieldDesc:"\u89D2\u8272",formType:"tag"},{fieldName:"status",fieldDesc:"\u72B6\u6001",formType:"switch",callFunction:u==null?void 0:u.changeSwitch},{fieldName:"createTime",fieldDesc:"\u521B\u5EFA\u65F6\u95F4",width:160},{fieldName:"remark",fieldDesc:"\u5907\u6CE8",showOverflowTooltip:!0,active:!1},{fieldName:"#",fieldDesc:"\u64CD\u4F5C",formType:"operation",width:155,fixed:"right",operation:[{icon:"edit",label:"\u7F16\u8F91",callFunction:u==null?void 0:u.edit},{icon:"delete",label:"\u5220\u9664",confirm:!0,callFunction:u==null?void 0:u.delete}]}],i=[{fieldName:"username",fieldDesc:"\u7528\u6237\u540D",fieldType:m.INPUT},{fieldName:"role",fieldDesc:"\u89D2\u8272",fieldType:m.SELECT,config:{api:N,valueKey:"role",multiple:!0}},{fieldName:"deptId",fieldDesc:"\u6240\u5C5E\u90E8\u95E8",fieldType:m.SELECT,config:{api:k,tree:!0,multiple:!0,init:!0,nodeKey:"deptId",props:{label:"deptName",children:"children"}}},{fieldName:"remark",fieldDesc:"\u5907\u6CE8",fieldType:m.INPUT,config:{type:"textarea"}}];return{filterColumn:p,tableColumn:a,dialogColumn:i}}const ee=b({__name:"DeptTree",emits:["filter"],setup(u,{emit:p}){const a=F({keyword:"",treeData:[],defaultProps:{children:"children",label:"deptName"}}),i=E();I(()=>{d()});const d=async()=>{const e=await k();a.treeData=e.data},f=(e,n)=>e?n[a.defaultProps.label].includes(e):!0,c=e=>{p("filter",e.deptId)};return H(()=>a.keyword,e=>{o(i).filter(e)}),(e,n)=>{const h=U,D=J,y=M;return C(),S(y,{title:"\u7EC4\u7EC7\u67B6\u6784",showHelp:"",helpText:"\u70B9\u51FB\u90E8\u95E8\u53EF\u663E\u793A\u5BF9\u5E94\u7684\u7528\u6237",class:"account-dept"},{extra:w(()=>[_(h,{modelValue:a.keyword,"onUpdate:modelValue":n[0]||(n[0]=g=>a.keyword=g),size:"small",style:{width:"145px"}},null,8,["modelValue"])]),default:w(()=>[_(D,{ref_key:"deptTreeRef",ref:i,"node-key":"deptId","highlight-current":"",data:a.treeData,props:a.defaultProps,"default-expand-all":"","expand-on-click-node":!1,onNodeClick:c,"filter-node-method":f},null,8,["data","props"])]),_:1})}}});const te=x(ee,[["__scopeId","data-v-1106f145"]]),ae=b({__name:"UserDialog",emits:["success"],setup(u,{expose:p,emit:a}){const{success:i}=B(),d=F({}),{dialogColumn:f}=v(),c=E(),e=E(),n=E(!1),h={username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:["blur","change"]}],role:[{type:"array",required:!0,message:"\u8BF7\u9009\u62E9\u89D2\u8272",trigger:["blur","change"]}],deptId:[{type:"array",required:!0,message:"\u8BF7\u9009\u62E9\u90E8\u95E8",trigger:["blur","change"]}]},D=Q(()=>o(n)?"\u4FEE\u6539\u7528\u6237":"\u65B0\u589E\u7528\u6237"),y=(s={})=>{o(c).showDialog(),G(()=>{var r,l;o(e).instance.resetFields(),n.value=!!s.id,o(n)&&Object.assign(d,s,{role:(r=s.role)==null?void 0:r.split(","),deptId:(l=s.deptId)==null?void 0:l.split(",").map(T=>parseFloat(T))})})},g=()=>{o(c).hideDialog()},t=async s=>{await o(e).instance.validate(async r=>{if(!r)return;const l=$(d);Object.assign(l,{deptId:l.deptId.join(),role:l.role.join()}),s(!0);try{o(n)?await V(l):await A(l),i(o(n)?"\u4FEE\u6539\u6210\u529F":"\u65B0\u589E\u6210\u529F\uFF01"),a("success"),g()}finally{s(!1)}})};return p({showDialog:y,hideDialog:g}),(s,r)=>{const l=Z,T=P;return C(),S(T,{ref_key:"baseDialogRef",ref:c,width:"560px",title:o(D),onSave:t},{default:w(()=>[_(l,{ref_key:"baseFormRef",ref:e,columns:o(f),rules:h,model:d},null,8,["columns","model"])]),_:1},8,["title"])}}}),se={class:"system-account-container flex"},oe={class:"account-user"},ue=b({__name:"index",setup(u){const{tableColumn:p,filterColumn:a}=v({edit:D,delete:y,changeSwitch:g}),{success:i}=B(),d=F({columns:a,showOpen:!1,onSearch:e,searchInfo:{deptId:""}}),f=F({columns:p,data:[],pagination:{currentPage:1,pageSize:10,total:0},onRefresh:e}),c=E();I(()=>{e()});async function e(){const{currentPage:t,pageSize:s}=f.pagination,r=await j({...d.searchInfo,currentPage:t,pageSize:s});f.data=r.data.list||[],f.pagination.total=r.data.total}function n(t){d.searchInfo.deptId=t,e()}function h(){o(c).showDialog()}function D(t){o(c).showDialog(t.row)}async function y(t){const{id:s}=t.row;await q({id:s}),i("\u5220\u9664\u6210\u529F"),e()}async function g(t){return L(`\u786E\u8BA4\u8981${t.status===0?"\u542F\u7528":"\u505C\u7528"}\u8BE5\u7528\u6237\u5417?`).then(async()=>{await K({id:t.id}),i(`${t.status===0?"\u542F\u7528":"\u505C\u7528"}\u6210\u529F`),e()})}return(t,s)=>{const r=O,l=R;return C(),W("div",se,[_(te,{onFilter:n}),X("div",oe,[_(l,{"table-title":"\u7528\u6237\u5217\u8868","filter-config":d,"table-config":f},{buttons:w(()=>[_(r,{type:"primary",onClick:h},{default:w(()=>[Y("\u65B0\u589E\u7528\u6237")]),_:1})]),_:1},8,["filter-config","table-config"])]),_(ae,{ref_key:"userDialogRef",ref:c,onSuccess:e},null,512)])}}});const Fe=x(ue,[["__scopeId","data-v-d0a89349"]]);export{Fe as default};
