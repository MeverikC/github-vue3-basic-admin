import{_ as S}from"./index.76ed4355.js";import{q as x,f as C,B as I,b as M}from"./index.c8e2dcea.js";import{e as P,a as $,b as O,d as q,c as v}from"./role.a9dd1ead.js";import{_ as L}from"./base-form.vue_vue_type_script_setup_true_lang.c98d8f13.js";import{d as w,n as _,aB as b,aQ as E,c as U,b0 as A,o as N,v as K,w as h,b as m,u,$ as j,f as z,N as V}from"./.pnpm.b1628590.js";import{F as c}from"./componentEnum.0faf2556.js";import{S as Q}from"./basic.9db2ab82.js";import{g as G}from"./menu.32e30cbc.js";import"./base-table.2b7e77b0.js";import"./base-column-setting.a0a6ed20.js";import"./index.6af4874b.js";import"./base-filter.7cf189b8.js";import"./base-select.vue_vue_type_script_lang.6ab47f0d.js";import"./base-input-number.4f01add9.js";import"./base-icon-picker.vue_vue_type_style_index_0_lang.13a967cb.js";function T(s){const d=[{fieldName:"roleName",fieldDesc:"\u89D2\u8272\u540D\u79F0",fieldType:c.INPUT},{fieldName:"status",fieldDesc:"\u72B6\u6001",fieldType:c.SELECT,config:{options:Q}}],f=[{fieldName:"id",fieldDesc:"id",showOverflowTooltip:!0},{fieldName:"roleName",fieldDesc:"\u89D2\u8272\u540D\u79F0"},{fieldName:"role",fieldDesc:"\u89D2\u8272\u6807\u8BC6",formType:"tag"},{fieldName:"status",fieldDesc:"\u72B6\u6001",formType:"switch",callFunction:s==null?void 0:s.changeSwitch},{fieldName:"createTime",fieldDesc:"\u521B\u5EFA\u65F6\u95F4",width:160},{fieldName:"remark",fieldDesc:"\u5907\u6CE8",showOverflowTooltip:!0},{fieldName:"#",fieldDesc:"\u64CD\u4F5C",formType:"operation",width:175,fixed:"right",operation:[{icon:"edit",label:"\u7F16\u8F91",callFunction:s==null?void 0:s.edit},{icon:"delete",label:"\u5220\u9664",confirm:!0,callFunction:s==null?void 0:s.delete}]}],n=[{fieldName:"roleName",fieldDesc:"\u89D2\u8272\u540D\u79F0",fieldType:c.INPUT},{fieldName:"role",fieldDesc:"\u89D2\u8272\u6807\u8BC6",fieldType:c.INPUT},{fieldName:"menuIds",fieldDesc:"\u83DC\u5355",fieldType:c.SLOT},{fieldName:"remark",fieldDesc:"\u5907\u6CE8",fieldType:c.INPUT,config:{type:"textarea"}}];return{filterColumn:d,tableColumn:f,dialogColumn:n}}const H=w({__name:"RoleDialog",emits:["success"],setup(s,{expose:d,emit:f}){const{success:n}=C(),{dialogColumn:p}=T(),i=_(),l=_(),o=_(),e=b({isEdit:!1,treeData:[],defaultProps:{children:"children",label:"menuName"},formModel:{}}),D={roleName:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",trigger:["blur","change"]}],role:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u6807\u8BC6",trigger:["blur","change"]}],menuIds:[{type:"array",required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355",trigger:["blur","change"]}]};E(async()=>{const t=await G();e.treeData=t.data});const y=U(()=>e.isEdit?"\u4FEE\u6539\u89D2\u8272":"\u65B0\u589E\u89D2\u8272"),F=(t={})=>{u(i).showDialog(),j(()=>{u(l).instance.resetFields(),e.isEdit=!!t.id,e.isEdit?(Object.assign(e.formModel,t),u(o).setCheckedKeys(t.menuIds)):u(o).setCheckedKeys([])})},a=()=>{u(i).hideDialog()},r=async t=>{Object.assign(e.formModel,{menuIds:u(o).getCheckedKeys()}),await u(l).instance.validate(async g=>{if(!!g){t(!0);try{e.isEdit?await P(e.formModel):await $(e.formModel),n(e.isEdit?"\u4FEE\u6539\u6210\u529F":"\u65B0\u589E\u6210\u529F\uFF01"),f("success"),a()}finally{t(!1)}}})};return d({showDialog:F,hideDialog:a}),(t,g)=>{const B=A,k=L,R=x;return N(),K(R,{ref_key:"baseDialogRef",ref:i,width:"560px",title:u(y),onSave:r},{default:h(()=>[m(k,{ref_key:"baseFormRef",ref:l,columns:u(p),rules:D,model:e.formModel},{menuIds:h(()=>[m(B,{ref_key:"roleTreeRef",ref:o,"node-key":"id","highlight-current":"",data:e.treeData,props:e.defaultProps,"show-checkbox":"","expand-on-click-node":!1},null,8,["data","props"])]),_:1},8,["columns","model"])]),_:1},8,["title"])}}}),J={class:"system-role-container"},de=w({__name:"index",setup(s){const{tableColumn:d,filterColumn:f}=T({edit:D,delete:y,changeSwitch:F}),{success:n}=C(),p=b({columns:f,onSearch:o,showOpen:!1,searchInfo:{}}),i=b({columns:d,data:[],pagination:{currentPage:1,pageSize:10,total:0},onRefresh:o}),l=_();E(()=>{o()});async function o(){const{currentPage:a,pageSize:r}=i.pagination,t=await O({...p.searchInfo,currentPage:a,pageSize:r});i.data=t.data.list||[],i.pagination.total=t.data.total}function e(){u(l).showDialog()}function D(a){u(l).showDialog(a.row)}async function y(a){const{id:r}=a.row;await q({id:r}),n("\u5220\u9664\u6210\u529F"),o()}async function F(a){return I(`\u786E\u8BA4\u8981${a.status===0?"\u542F\u7528":"\u505C\u7528"}\u8BE5\u89D2\u8272\u5417?`).then(async()=>{await v({id:a.id}),n(`${a.status===0?"\u542F\u7528":"\u505C\u7528"}\u6210\u529F}`),o()})}return(a,r)=>{const t=M,g=S;return N(),z("div",J,[m(g,{"table-title":"\u89D2\u8272\u5217\u8868","filter-config":p,"table-config":i},{buttons:h(()=>[m(t,{type:"primary",onClick:e},{default:h(()=>[V("\u65B0\u589E\u89D2\u8272")]),_:1})]),_:1},8,["filter-config","table-config"]),m(H,{ref_key:"roleDialogRef",ref:l,onSuccess:o},null,512)])}}});export{de as default};
